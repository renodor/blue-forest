<!-- render add to cart modal if params is present -->
<%= render 'shared/atc_modal' if params[:atc_modal] %>

<div class="container pdp-container">
  <div class="pdp d-flex">
    <div class="grow-1">
      <div id="pdp-carousel" class="carousel slide">
        <div class="carousel-inner">
        <!-- iterate over all photos to put it in the carousel the 'main photo' is first one of the array, so put the class 'active' by default to the first one -->
          <% @product.product_photos.each do |product_photo| %>
            <% if product_photo.main %>
              <% product_photo.photos.each_with_index do |photo, i| %>
                <div class="carousel-item <%= 'active' if i == 0 %>" data-color="<%= product_photo.color %>" data-order=<%= i+1 %> >
                  <%= cl_image_tag photo.key, height: 500, width: 500, crop: :fill, class: "product-image" %>
                </div>
              <% end %>
            <% else %>
              <% product_photo.photos.each_with_index do |photo, i| %>
                <div class="display-none" data-color="<%= product_photo.color %>" data-order=<%= i+1 %> >
                  <%= cl_image_tag photo.key, height: 500, width: 500, crop: :fill, class: "product-image" %>
                </div>
              <% end %>
            <% end %>
          <% end %>
        </div>
        <a class="carousel-control-prev" href="#pdp-carousel" role="button" data-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
        </a>
        <a class="carousel-control-next" href="#pdp-carousel" role="button" data-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </a>
      </div>
    </div>
    <div class="product-info">
      <h1><%= @product.name.upcase %></h1>
      <p><%= @product.short_description.upcase %></p>
      <p class="prices">
        <span class="price <%= "crossed" if @product_variations.first.discount_price %>" >$<%= @product_variations.first.price %></span>
        <span class="discount-price"><%= "$#{@product_variations.first.discount_price}" if @product_variations.first.discount_price %></span>
       </p>
      <%= form_tag line_items_path do %>
        <div class="variations">
          <% if @colors %>
            <div class="colors">
              <% @colors.each_with_index do |color, i| %>
                <!-- the third value of radio_button_tag define is the button is checked or not
                putting i == 0 here will automatically check the first color -->
                <%= radio_button_tag 'color', color, i == 0 %>
                <%= label_tag "color_#{color}", "", style: "background-color: #{color}" %>
              <% end %>
            </div>
          <% end %>
          <div class="sizes">
            <% @product_variations.each_with_index do |variation, i| %>
              <!-- if size is inot unique, show sizes -->
              <!-- (it still possible to have several 'unique' sizes, if there are several colors -->
              <!-- for example a product can have a 'red' (unique size), variation and a 'green' (unique size) variation -->
              <% if variation.size.downcase != 'unique' %>
                <!-- the data-price helps to dynamically change the displayed price (regarding the selected size) -->
                <!-- the data-color helps map size variations to the correct selected color -->
                <!-- the data-repeated-for list for what colors this size is repeated. It allows to remove repeated sizes from the front end, but only if the correct color is selected (otherwise repeated colors would disapear completely when it is not the correct color that is selected) -->
                <%= radio_button_tag :variation_id, variation.id, false, 'data-price': variation.price, 'data-discount-price': variation.discount_price, 'data-color': variation.color, 'data-repeated-for': @sizes[variation.size][:colors] %>
                <%= label_tag "variation_id_#{variation.id}", variation.size %>
              <!-- if size is 'unique' automatically check the first 'unique' size -->
              <!-- (because if size is unique, it doesn't show on frontend, and each time a color is selected, it will automatically check its unique size. But we need to check the first one by default for when the page load) -->
              <!-- + add a data-unique attribute to trigger specific js method -->
              <% else %>
                <%= radio_button_tag :variation_id, variation.id, i == 0, 'data-price': variation.price, 'data-discount-price': variation.discount_price, 'data-color': variation.color, 'data-unique': true %>
              <% end %>
            <% end %>
          </div>
        </div>
        <div class="atc-container">
          <p class="size-selection-warning">Por favor seleccionar una talla</p>
          <%= button_tag type: "submit", class: "btn btn-yellow atc" do %>
            <span><%= image_tag 'cart.png' %></span>
            <span>ADD TO CART</span>
          <% end %>
          <span class="atc-overlay"></span>
        </div>
      <% end %>
    </div>
  </div>
</div>
<section class="product-detail-container">
  <div class="container">
    <div class="product-detail">
      <%= @product.long_description %>
    </div>
  </div>
</section>
