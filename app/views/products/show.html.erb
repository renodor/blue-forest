<!-- render add to cart modal if params is present -->
<%= render 'shared/atc_modal' if params[:atc_modal] %>

<div class="container pdp-container">
  <div class="pdp d-flex">
    <div class="grow-1">
      <div id="carouselExampleControls" class="carousel slide">
        <div class="carousel-inner">
        <!-- iterate over all photos to put it in the carousel the main one is first is the first one of the array, so put the class 'active' by default to the first one -->
          <% @photos.each_with_index do |photo, i| %>
            <div class="carousel-item <%= 'active' if i == 0 %>">
              <%= cl_image_tag photo.key, height: 500, width: 500, crop: :fill, class: "product-image" %>
            </div>
          <% end %>
        </div>
        <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
        </a>
        <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </a>
      </div>
    </div>
    <div class="product-info">
      <h1><%= @product.name.upcase %></h1>
      <p><%= @product.short_description.upcase %></p>
      <p class="prices">
        <span class="price <%= "crossed" if @product_variations.first.discount_price %>" >$<%= @product_variations.first.price %></span>
        <span class="discount-price"><%= "$#{@product_variations.first.discount_price}" if @product_variations.first.discount_price %></span>
       </p>
      <%= form_tag line_items_path do %>
        <div class="variations">
          <div class="colors">
            <% @colors.each_key do |color| %>
              <% if color == @colors.keys[0] %>
                <%= radio_button_tag 'color', color, true, 'data-color': color %>
              <% else %>
                <%= radio_button_tag 'color', color, false, 'data-color': color %>
              <% end %>
              <%= label_tag "color_#{color}", color %>
            <% end %>
          </div>
          <div class="size">

            <% @product_variations.each do |variation| %>
                <% if @sizes[variation.size] > 1 %>
                  <%= radio_button_tag :variation_id, variation.id, false, 'data-price': variation.price, 'data-discount-price': variation.discount_price, 'data-color': variation.color, 'data-repeated': true %>
                  <%= label_tag "variation_id_#{variation.id}", variation.size %>
                <% else %>
                                 <%= radio_button_tag :variation_id, variation.id, false, 'data-price': variation.price, 'data-discount-price': variation.discount_price, 'data-color': variation.color %>
                  <%= label_tag "variation_id_#{variation.id}", variation.size %>
                <% end %>

            <% end %>

            <%# @product_variations.each do |variation| %>
              <%# if variation.size.downcase != 'unique' %>
                <%#= radio_button_tag :variation_id, variation.id, false, 'data-price': variation.price, 'data-discount-price': variation.discount_price %>
                <%#= label_tag "variation_id_#{variation.id}", variation.size %>
              <%# else %>
                <%#= radio_button_tag :variation_id, variation.id, true %>
              <%# end %>
            <%# end %>
          </div>
        </div>
        <div class="atc-container">
          <p class="size-selection-warning">Por favor seleccionar una talla</p>
          <%= button_tag type: "submit", class: "btn btn-yellow atc" do %>
            <span><%= image_tag 'cart.png' %></span>
            <span>ADD TO CART</span>
          <% end %>
          <span class="atc-overlay"></span>
        </div>
      <% end %>
    </div>
  </div>
</div>
<section class="product-detail-container">
  <div class="container">
    <div class="product-detail">
      <%= @product.long_description %>
    </div>
  </div>
</section>
