<!-- render add to cart modal if params is present -->
<%= render 'shared/atc_modal' if params[:atc_modal] %>

<div class="container pdp-container">
  <div class="pdp d-flex">
    <div class="grow-1">
      <div id="carouselExampleControls" class="carousel slide">
        <div class="carousel-inner">
        <!-- iterate over all photos to put it in the carousel the 'main photo' is first one of the array, so put the class 'active' by default to the first one -->
          <% @photos.each_with_index do |photo, i| %>
            <div class="carousel-item <%= 'active' if i == 0 %>">
              <%= cl_image_tag photo.key, height: 500, width: 500, crop: :fill, class: "product-image" %>
            </div>
          <% end %>
        </div>
        <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
        </a>
        <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </a>
      </div>
    </div>
    <div class="product-info">
      <h1><%= @product.name.upcase %></h1>
      <p><%= @product.short_description.upcase %></p>
      <p class="prices">
        <span class="price <%= "crossed" if @product_variations.first.discount_price %>" >$<%= @product_variations.first.price %></span>
        <span class="discount-price"><%= "$#{@product_variations.first.discount_price}" if @product_variations.first.discount_price %></span>
       </p>
      <%= form_tag line_items_path do %>
        <div class="variations">
          <% if @colors.length > 1 %>
            <div class="colors">
              <% @colors.each_with_index do |color, i| %>
                <!-- the third value of radio_button_tag define is the button is checked or not
                putting i == 0 here will automatically check the first color -->
                <%= radio_button_tag 'color', color, i == 0, 'data-color': color %>
                <%= label_tag "color_#{color}", "", style: "background-color: #{color}" %>
              <% end %>
            </div>
          <% end %>
          <div class="sizes">
            <% @product_variations.each do |variation| %>
              <!-- if size is inot unique, show sizes -->
              <!-- (it still possible to have several 'unique' sizes, if there are several colors -->
              <!-- for example a product that have a 'red' (unique), variation and a 'green' (unique) variation -->
              <% if variation.size.downcase != 'unique' %>
                <!-- the data-price helps to dynamically change the displayed price (regarding to selected size) -->
                <!-- the data-color helps map size variations to the correct selected sizes -->
                <!-- the data-repeated will be 'true' if size is repeated and 'false' otherwise. It helps remove duplicated sizes accross colors from the DOM regarding what color is selected -->
                <%= radio_button_tag :variation_id, variation.id, false, 'data-price': variation.price, 'data-discount-price': variation.discount_price, 'data-color': variation.color, 'data-repeated': @sizes[variation.size] > 1 %>
                <%= label_tag "variation_id_#{variation.id}", variation.size %>
              <!-- if size is unique, don't show sizes, and check size by default -->
              <% else %>
                <%= radio_button_tag :variation_id, variation.id, true, 'data-price': variation.price, 'data-discount-price': variation.discount_price, 'data-color': variation.color %>
              <% end %>
            <% end %>
          </div>
        </div>
        <div class="atc-container">
          <p class="size-selection-warning">Por favor seleccionar una talla</p>
          <%= button_tag type: "submit", class: "btn btn-yellow atc" do %>
            <span><%= image_tag 'cart.png' %></span>
            <span>ADD TO CART</span>
          <% end %>
          <span class="atc-overlay"></span>
        </div>
      <% end %>
    </div>
  </div>
</div>
<section class="product-detail-container">
  <div class="container">
    <div class="product-detail">
      <%= @product.long_description %>
    </div>
  </div>
</section>
