<div class="container orders-funnel">
  <%= render 'shared/order_breadcrumb' %>
  <br>
  <h1>¡PEDIDO CONFIRMADO!</h1>

  <div class="order-review">
    <div class="order-summary">
      <% total_quantity = 0 %>
      <% @order.line_items.reverse.each do |line_item| %>
        <div class="cart-product d-flex align-items-center">
          <% if line_item.photo_key %>
            <%= cl_image_tag line_item.photo_key, height: 150, width: 150, crop: :fill %>
          <% else %>
            <div class="product-photo-placeholder-small"></div>
          <% end %>
          <div class="grow-1">
            <p><b><%= line_item.product_variation.product.name %></b></p>
            <% if line_item.product_variation.color %>
              <p>Color: <%= t(line_item.product_variation.color) %></p>
            <% end %>
            <p>Tamaño: <%= line_item.product_variation.size %></p>
            <p>
              <% if line_item.product_variation.discount_price %>
                <span class="crossed">$<%= line_item.product_variation.price %></span>
                <span>$<%= line_item.product_variation.discount_price %></span>
              <% else %>
                $<%= line_item.product_variation.price %>
              <% end %>
            </p>
            <p>Cantidad: <%= line_item.quantity %></p>
          </div>
          <% total_quantity += line_item.quantity %>
        </div>
      <% end %>
    </div>
    <div class="order-detail">
      <h2>Información de contacto</h2>
      <p><%= @user.first_name %> <%= @user.last_name %></p>
      <p><%= @user.email %></p>
      <p><%= @user.phone %></p>
      <h2>Dirección</h2>
      <p><%= @address.street %></p>
      <p><%= @address.flat_number %></p>
      <p><%= @address.district %></p>
      <p><%= @address.area %></p>
      <p><%= @address.detail %></p>
      <p><%= @address.city %></p>
      <div id="show-address-map"
       style="width: 100%; height: 200px;"
       data-lat="<%= @address.latitude %>"
       data-lng="<%= @address.longitude %>"
       data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>"></div>
    </div>
  </div>
  <div class="order-review-footer">
    <div class="my-3">
      <p><%= total_quantity %> <%= t('products', count: total_quantity) %></p>
      <p>Sub Total: $<%= @order.sub_total %></p>
       <p>Entrega:
          <% if @order.shipping > 0 %>
            $<%= @order.shipping %>
          <% else %>
            <b>¡Envío gratuito!</b>
          <% end %>
        </p>
      <p>ITBMS (7%): $<%= (@order.itbms) %></p>
      <p><b>TOTAL: $<%= @order.total %></b></p>
    </div>
    <div class="order-review-footer-bottom mt-3">
      <p class='text-center'>Todos los pagos se hacen contra entrega. Gracias por preferirnos.</p>
      <div class="payment-logos">
        <%= cl_image_tag 'https://res.cloudinary.com/blueforest/image/upload/v1591088125/payments-logo/1-visa_unvmtw.png', width: 50, crop: :fill, style: 'background-color: white, padding: 10px;' %>
        <%= cl_image_tag 'https://res.cloudinary.com/blueforest/image/upload/v1591088122/payments-logo/2-mastercard_scrnh5.png', width: 50, crop: :fill %>
        <%= cl_image_tag 'https://res.cloudinary.com/blueforest/image/upload/v1591088123/payments-logo/3-clave_dzrpsj.png', width: 50, crop: :fill %>
        <%= cl_image_tag 'https://res.cloudinary.com/blueforest/image/upload/v1591088122/payments-logo/4-yappy_mzep5g.png', width: 50, crop: :fill %>
        <%= cl_image_tag 'https://res.cloudinary.com/blueforest/image/upload/v1591088122/payments-logo/5-ach_omk444.png', width: 50, crop: :fill %>
        <%= cl_image_tag 'https://res.cloudinary.com/blueforest/image/upload/v1591088122/payments-logo/6-cash2_vkbbym.png', width: 50, crop: :fill %>
      </div>
    </div>
  </div>
</div>
